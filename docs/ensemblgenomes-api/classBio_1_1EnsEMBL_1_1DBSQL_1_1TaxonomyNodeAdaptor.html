<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ensembl Genomes: Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor Class Reference</title>
<link href="/info/docs/Doxygen/doxygen.css" rel="stylesheet" type="text/css" />
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div! -->

<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
  
  
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directory&#160;Browser</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="annotated.html"><span>Full&#160;Class&#160;List</span></a></li>
      <li><a href="functions.html"><span>Methods&#160;from&#160;all&#160;packages</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Available Methods</a>  </div>
  <div class="headertitle">
<div class="title">Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor Class Reference</div>  </div>
</div>
<div class="contents">
<!-- doxytag: class="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor" -->
<p><a href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor-members.html">List of all members.</a></p>
<hr/><a name="details" id="details"></a><h2>Class Summary</h2>
<div class="textblock"><h2><a class="anchor" id="Synopsis"></a>
Synopsis</h2>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#create an adaptor (Registry cannot be used currently)</span>
<span class="preprocessor"></span>my $tax_dba =  <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyDBAdaptor.html">Bio::EnsEMBL::DBSQL::TaxonomyDBAdaptor</a>-&gt;new(
                                      -user   =&gt; $tax_user,
                                      -pass   =&gt; $tax_pass,
                                      -dbname =&gt; $tax_db,
                                      -host   =&gt; $tax_host,
                                      -port   =&gt; $tax_port);                                      
my $node_adaptor = $tax_dba-&gt;get_TaxonomyNodeAdaptor();
<span class="preprocessor"># get a node for an ID</span>
<span class="preprocessor"></span>my $node = $node_adaptor-&gt;fetch_by_taxon_id(511145);
<span class="preprocessor"># print some info</span>
<span class="preprocessor"></span>printf <span class="stringliteral">&quot;Node %d is %s %s\n&quot;</span>,$node-&gt;taxon_id(),$node-&gt;rank(),$node-&gt;names()-&gt;{<span class="stringliteral">&#39;scientific name&#39;</span>}-&gt;[0];
<span class="preprocessor"># Finding ancestors</span>
<span class="preprocessor"></span>my @lineage = @{$node_adaptor-&gt;fetch_ancestors($node)};
<span class="keywordflow">for</span> my $node (@lineage) {
    printf <span class="stringliteral">&quot;Node %d is %s %s\n&quot;</span>,$node-&gt;taxon_id(),$node-&gt;rank(),$node-&gt;names()-&gt;{<span class="stringliteral">&#39;scientific name&#39;</span>}-&gt;[0];
}
</pre></div> <h2><a class="anchor" id="Description"></a>
Description</h2>
 <pre>
A database adaptor allowing access to the nodes of the NCBI taxonomy. It is currently managed independently of the registry:
my $tax_dba =  Bio::EnsEMBL::DBSQL::TaxonomyDBAdaptor->new(
									  -user   => $tax_user,
									  -pass   => $tax_pass,
									  -dbname => $tax_db,
									  -host   => $tax_host,
									  -port   => $tax_port);
									  									  
my $node_adaptor = $tax_dba->get_TaxonomyNodeAdaptor();
# or alternatively
my $node_adaptor = Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor->new($tax_dba);

The TaxonomyNodeAdaptor handles TaxonomyNode objects, which represent nodes in the NCBI taxonomy

There are two main practical uses for the :
1. Accessing the taxonomy database to find species of interest and to then find those within the ENA databases e.g. to find all 
descendants of the node representing Escherichia coli:
	my $node = $node_adaptor->fetch_by_taxon_id(562);
	for my $child (\@{$node_adaptor->fetch_descendants($node)}) {
		my $dbas = $helper->get_all_by_taxon_id($node->taxon_id())
		if(defined $dbas) {
			for my $dba (\@{$dbas}) {
				# do something with the $dba
			}
		}
	}

2. Placing ENA species into a taxonomic hierarchy and manipulating that hierarchy (mainly for use in the web interface)
	# iterate over all dbas from a registry or ENARegistryHelper
	for my $dba (\@{$helper->get_all_DBAdaptors()}) {
		my $node = $node_adaptor->fetch_by_coredbadaptor($dba);
		# add the node to a hash set of leaf nodes if not already there
		if ( $leaf_nodes->{ $node->taxon_id() } ) {
			$node = $leaf_nodes->{ $node->taxon_id() };
		} else {
			$leaf_nodes->{ $node->taxon_id() } = $node;
		}
		# attach the DBA to the node
		push \@{$node->dba()}, $dba;
	}
	my \@leaf_nodes = values(%$leaf_nodes);
	# get the root of the tree
	my $root = $node_adaptor->fetch_by_taxon_id(1);
	# get rid of all branches of the taxonomy that don't involve a node from the dba
	$node_adaptor->build_pruned_tree( $root, \\@leaf_nodes );
	# collapse 
	$node_adaptor->collapse_tree($root);
	
</pre> 
<p>Definition at line <a class="el" href="TaxonomyNodeAdaptor_8pm_source.html#l00082">82</a> of file <a class="el" href="TaxonomyNodeAdaptor_8pm_source.html">TaxonomyNodeAdaptor.pm</a>.</p>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Available Methods</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">protected Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a72b0b72d7d1e7ce3ccf0720010c56d03">_build_node_array</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a7e52066975c92f13a1c521f9ab541d61">_get_node</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">protected&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a74bc6bc12ca4f3f296087f2b85713855">_get_node_id</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">protected <br class="typebreak"/>
<a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a2faf0ff0de062dc2031575f4858d0d4d">_get_parent_by_index</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">protected Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a2fc8c7b942a628936313d5e03e4a1e4b">_restrict_set</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#acdad70d2aaa7bb3a76d297560ec08958">add_descendants</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ac439f27cfa56d62951ee761e80bf17db">associate_nodes</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#aa22e5e1ec651d855006177c93ef29234">build_pruned_tree</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a54ce8ea2ca13ac47d176599c5447303d">collapse_tree</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#aa17b7ee274efeb5b2fad803a3688a148">distance_between_nodes</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a847575dc0147e7f36b19fcf71250c6f7">fetch_all_by_name</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a2307ee0f9c8cbe32b60f20e27454199d">fetch_all_by_name_and_class</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a3634784808148457e7768d9ac23ac51d">fetch_all_by_name_and_rank</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#af1052de92e3deaab5011405e31b94878">fetch_all_by_rank</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a6498525eec319e5409bf467f85b10925">fetch_all_by_taxon_ids</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a4389669d002e2ca6caf932827b800aaf">fetch_all_common_ancestors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a0147113a768c4679c7c3ddc9a89cd69d">fetch_ancestor_by_rank</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ac07a1294368c2815845978ffa18db9b5">fetch_ancestors</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a0b5c7cbb3d249793ce0c3eae5baa41b4">fetch_by_coredbadaptor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a146f983269d80d82d56f12024b8df6a1">fetch_by_taxon_id</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ab0fd45baeccfc5ff5b2b4af3f52e699e">fetch_children</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#af7d2f5acd1d17eace8d94a48a0782790">fetch_common_ancestor</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ae75c96b99f505385c7729d1090785ee3">fetch_descendants</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a9b636d26c4e31842a9a023780a8990b9">fetch_descendants_offset</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public Arrayref&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a6f018c4e7c29a6dc11feb35f9a24c336">fetch_leaf_nodes</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a865809d8ad7f9bac8c618ca44ecdb7ac">fetch_parent</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#acb7cae1f0233c91c5fb7cfdc4d66d952">fetch_root</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a928c8d80cd69b686228238604f2ebf52">helper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a143bb1730451f74d6742661bbd989775">mapper</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">public void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a02d590171e2d14da87085d57116d751f">set_num_descendants</a> ()</td></tr>
</table>
<hr/><h2>Method Documentation</h2>
<a class="anchor" id="a72b0b72d7d1e7ce3ccf0720010c56d03"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_build_node_array" ref="a72b0b72d7d1e7ce3ccf0720010c56d03" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_build_node_array </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>Description: Build a sparse array based on left/right indices of a set of nodes to allow speedy lookup
Argument: Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Return type: Arrayref containing arrayref of 1/0 by left/right, min left index, max right index
 </pre><div id="codesection-_build_node_array" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-_build_node_array-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_build_node_array-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_build_node_array-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a72b0b72d7d1e7ce3ccf0720010c56d03">_build_node_array</a> {
  my ($self, $leaf_nodes) = @_;
  my $array;
  my $lmin = 0;
  my $rmax = 0;
  <span class="keywordflow">for</span> my $node (@$leaf_nodes) {
    <span class="keywordflow">if</span> (!$node-&gt;{left_index} || !$node-&gt;{right_index}) {
      print Dumper($node);
      <span class="keywordflow">throw</span> <span class="stringliteral">&quot;Indices not set for &quot;</span> . $node-&gt;to_string();
    }
    $array-&gt;[$node-&gt;{left_index}]  = 1;
    $array-&gt;[$node-&gt;{right_index}] = 1;
    $lmin =
      ($lmin == 0 || $node-&gt;{left_index} &lt; $lmin)
      ? $node-&gt;{left_index}
      : $lmin;
    $rmax = ($rmax &lt; $node-&gt;{right_index}) ? $node-&gt;{right_index} : $rmax;
  }
  <span class="keywordflow">return</span> [$array, $lmin, $rmax];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a7e52066975c92f13a1c521f9ab541d61"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_get_node" ref="a7e52066975c92f13a1c521f9ab541d61" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_get_node </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_get_node" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-_get_node-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_get_node-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_get_node-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a7e52066975c92f13a1c521f9ab541d61">_get_node</a> {
  my ($self, $node) = @_;
  <span class="keywordflow">if</span> (ref($node) eq <span class="stringliteral">&#39;Bio::EnsEMBL::TaxonomyNode&#39;</span>) {
    <span class="keywordflow">return</span> $node;
  } <span class="keywordflow">else</span> {
    <span class="keywordflow">return</span> $self-&gt;fetch_by_taxon_id($node);
  }
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a74bc6bc12ca4f3f296087f2b85713855"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_get_node_id" ref="a74bc6bc12ca4f3f296087f2b85713855" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_get_node_id </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-_get_node_id" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-_get_node_id-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_get_node_id-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_get_node_id-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a74bc6bc12ca4f3f296087f2b85713855">_get_node_id</a> {
  my ($node) = @_;
  my $node_id;
  <span class="keywordflow">if</span> (ref($node) eq <span class="stringliteral">&#39;Bio::EnsEMBL::TaxonomyNode&#39;</span>) {
    <span class="keywordflow">return</span> $node-&gt;taxon_id();
  } <span class="keywordflow">else</span> {
    <span class="keywordflow">return</span> $node;
  }
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a2faf0ff0de062dc2031575f4858d0d4d"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_get_parent_by_index" ref="a2faf0ff0de062dc2031575f4858d0d4d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_get_parent_by_index </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>Description: Find the parent of a node, initially based on left/right index to find direct parent, and then by recursion through parents to work back to the closest common ancestor.
Argument: Current node
Argument: Prospective parent
Return type: <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-_get_parent_by_index" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-_get_parent_by_index-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_get_parent_by_index-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_get_parent_by_index-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a2faf0ff0de062dc2031575f4858d0d4d">_get_parent_by_index</a> {
  my ($self, $leaf_node, $node) = @_;
  my $parent;
  <span class="keywordflow">if</span> (   $node-&gt;{left_index} &lt; $leaf_node-&gt;{left_index}
      &amp;&amp; $node-&gt;{right_index} &gt; $leaf_node-&gt;{right_index})
  {
    $parent = $node;
  } elsif (defined $node-&gt;{parent}) {
    $parent = $self-&gt;_get_parent_by_index($leaf_node, $node-&gt;{parent});
  }
  <span class="keywordflow">return</span> $parent;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a2fc8c7b942a628936313d5e03e4a1e4b"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_restrict_set" ref="a2fc8c7b942a628936313d5e03e4a1e4b" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">protected Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::_restrict_set </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>Description: Restrict the input set to those needed to build a tree including all members of the leaf set
Argument: Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> (leaf set)
Argument: Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> (input set)
Return: Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-_restrict_set" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-_restrict_set-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-_restrict_set-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-_restrict_set-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a2fc8c7b942a628936313d5e03e4a1e4b">_restrict_set</a> {
  my ($self, $leaf_nodes, $input_set) = @_;
<span class="preprocessor">  # build sparse array</span>
<span class="preprocessor"></span>  my ($node_array, $lmin, $rmax) = @{$self-&gt;_build_node_array($leaf_nodes)};
<span class="preprocessor">  # hash leaf nodes by taxon_id to allow replacement</span>
<span class="preprocessor"></span>  my %leaves = map { $_-&gt;taxon_id() =&gt; $_ } @$leaf_nodes;
  my @output_set;
<span class="preprocessor">  # iterate over everything in the min/max range</span>
<span class="preprocessor"></span>  <span class="keywordflow">for</span> my $node (grep { $_-&gt;{right_index} &gt;= $lmin || $_-&gt;{left_index} &lt;= $rmax } @$input_set) {
    my $leaf = $leaves{$node-&gt;taxon_id()};
    <span class="keywordflow">if</span> (defined $leaf) {
      push @output_set, $leaf;
    } <span class="keywordflow">else</span> {
      <span class="keywordflow">for</span> (my $i = $node-&gt;{left_index}; $i &lt;= $node-&gt;{right_index}; $i++) {
        <span class="keywordflow">if</span> ($node_array-&gt;[$i]) {
          push @output_set, $node;
          last;
        }
      }
    }
  }
  <span class="keywordflow">return</span> \@output_set;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="acdad70d2aaa7bb3a76d297560ec08958"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::add_descendants" ref="acdad70d2aaa7bb3a76d297560ec08958" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public void Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::add_descendants </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch descendants for the supplied node and assemble into a tree
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Return type : None
 </pre><div id="codesection-add_descendants" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-add_descendants-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-add_descendants-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-add_descendants-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#acdad70d2aaa7bb3a76d297560ec08958">add_descendants</a> {
  my ($self, $node) = @_;
<span class="preprocessor">  # hash nodes</span>
<span class="preprocessor"></span>  $self-&gt;associate_nodes([$node, @{$self-&gt;fetch_descendants($node)}]);
  <span class="keywordflow">return</span>;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="ac439f27cfa56d62951ee761e80bf17db"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::associate_nodes" ref="ac439f27cfa56d62951ee761e80bf17db" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::associate_nodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Associate the supplied nodes into a tree based on left/right indices and return the root node
Argument    : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Return type : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-associate_nodes" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-associate_nodes-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-associate_nodes-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-associate_nodes-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ac439f27cfa56d62951ee761e80bf17db">associate_nodes</a> {
  my ($self, $nodes) = @_;
<span class="preprocessor">  # sort by left index</span>
<span class="preprocessor"></span>  my @nodes     = sort { $a-&gt;{left_index} &lt;=&gt; $b-&gt;{left_index} } @$nodes;
  my $root      = $nodes[0];
  my $last_node = undef;
<span class="preprocessor">  # walk through them finding parents which enclose them</span>
<span class="preprocessor"></span><span class="preprocessor">  # reset parent/child relationships</span>
<span class="preprocessor"></span>  <span class="keywordflow">for</span> my $node (@nodes) {
    $node-&gt;{parent_id} = 0;
    $node-&gt;{parent}    = undef;
    $node-&gt;{children}  = [];
    <span class="keywordflow">if</span> (defined $last_node) {
      my $parent = $self-&gt;_get_parent_by_index($node, $last_node);
      <span class="keywordflow">if</span> (defined $parent) {
        $node-&gt;{parent_id} = $parent-&gt;<a class="code" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html#a5cf70ea804280b71ae85e51e211c82ab">taxon_id</a>();
        $node-&gt;{parent}    = $parent;
        push @{$parent-&gt;{children}}, $node;
      }
    }
    $node-&gt;{root_id} = $root-&gt;taxon_id();
    $node-&gt;{root}    = $root;
    $last_node       = $node;
  }
  $self-&gt;set_num_descendants($root);
  <span class="keywordflow">return</span> $root;
} ## end sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ac439f27cfa56d62951ee761e80bf17db">associate_nodes</a>
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="aa22e5e1ec651d855006177c93ef29234"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::build_pruned_tree" ref="aa22e5e1ec651d855006177c93ef29234" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public void Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::build_pruned_tree </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>Description : Restrict supplied tree by list of key leaf nodes
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Argument    : Array ref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Return type : None
 </pre><div id="codesection-build_pruned_tree" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-build_pruned_tree-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-build_pruned_tree-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-build_pruned_tree-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#aa22e5e1ec651d855006177c93ef29234">build_pruned_tree</a> {
  my ($self, $root, $leaf_nodes) = @_;
<span class="preprocessor">  # get the test set and winnow</span>
<span class="preprocessor"></span>  my @nodes =
    grep { $_-&gt;taxon_id() != $root-&gt;taxon_id() } @{$self-&gt;_restrict_set($leaf_nodes, $self-&gt;fetch_descendants($root))};
  $self-&gt;associate_nodes([$root, @nodes]);
  <span class="keywordflow">return</span>;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a54ce8ea2ca13ac47d176599c5447303d"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::collapse_tree" ref="a54ce8ea2ca13ac47d176599c5447303d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public void Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::collapse_tree </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>Description : Remove all nodes from tree that do not fit the required criteria. By default, these are not branch points, the root node, leaf nodes or nodes with database adaptors.
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Argument    : Array ref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Argument    : (Optional) Subroutine reference which is used to define whether to retain a node
Return type : None
 </pre><div id="codesection-collapse_tree" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-collapse_tree-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-collapse_tree-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-collapse_tree-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a54ce8ea2ca13ac47d176599c5447303d">collapse_tree</a> {
  my ($self, $root, $check) = @_;
  my @nodes;
  $check ||= sub {
    my ($node) = @_;
    <span class="keywordflow">return</span> ($node-&gt;taxon_id() eq $root-&gt;taxon_id() || ($node-&gt;dba() &amp;&amp; scalar(@{$node-&gt;dba()}) &gt; 0) || scalar(@{$node-&gt;children()}) != 1 || scalar(@{$node-&gt;parent()-&gt;children()}) &gt; 1);
  };
  $root-&gt;traverse_tree(
    sub {
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="aa17b7ee274efeb5b2fad803a3688a148"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::distance_between_nodes" ref="aa17b7ee274efeb5b2fad803a3688a148" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Int Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::distance_between_nodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>Description : Count the number of steps in the shortest route from one node to another (via the common ancestor)
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Return type : Integer
 </pre><div id="codesection-distance_between_nodes" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-distance_between_nodes-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-distance_between_nodes-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-distance_between_nodes-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#aa17b7ee274efeb5b2fad803a3688a148">distance_between_nodes</a> {
  my ($self, $node1, $node2) = @_;

<span class="preprocessor">  # Have to preprend the end nodes to get the numbers right</span>
<span class="preprocessor"></span>  my $ancestors1 = $self-&gt;fetch_ancestors($node1);
  my $ancestors2 = $self-&gt;fetch_ancestors($node2);
  unshift @{$ancestors1}, $node1;
  unshift @{$ancestors2}, $node2;

  <span class="keywordflow">for</span> (my $i = 0; $i &lt; scalar @{$ancestors1}; $i++) {
    <span class="keywordflow">for</span> (my $j = 0; $j &lt; scalar @{$ancestors2}; $j++) {
      <span class="keywordflow">if</span> ($ancestors1-&gt;[$i]-&gt;taxon_id == $ancestors2-&gt;[$j]-&gt;taxon_id) {
        <span class="keywordflow">return</span> $i + $j;
      }
    }
  }

<span class="preprocessor">  # Something went dreadfully wrong</span>
<span class="preprocessor"></span>  <span class="keywordflow">return</span> -1;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a847575dc0147e7f36b19fcf71250c6f7"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_name" ref="a847575dc0147e7f36b19fcf71250c6f7" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes which have a name LIKE the supplied String
Argument    : Name as String (can contain SQL wildcards)
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_all_by_name" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_all_by_name-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_by_name-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_by_name-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a847575dc0147e7f36b19fcf71250c6f7">fetch_all_by_name</a> {
  my ($self, $name) = @_;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ join ncbi_taxa_name nan <span class="keyword">using</span> (taxon_id) where nan.name like ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$name]);
  <span class="keywordflow">return</span> [values %{$node}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a2307ee0f9c8cbe32b60f20e27454199d"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_name_and_class" ref="a2307ee0f9c8cbe32b60f20e27454199d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_name_and_class </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes which have a name and name class LIKE the supplied Strings
Argument    : Name as String (can contain SQL wildcards)
Argument    : Name class as String (can contain SQL wildcards)
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_all_by_name_and_class" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_all_by_name_and_class-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_by_name_and_class-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_by_name_and_class-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a2307ee0f9c8cbe32b60f20e27454199d">fetch_all_by_name_and_class</a> {
  my ($self, $name, $class) = @_;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ join ncbi_taxa_name nan <span class="keyword">using</span> (taxon_id) where nan.name like ? and nan.name_class like ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$name, $class]);
  <span class="keywordflow">return</span> [values %{$node}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a3634784808148457e7768d9ac23ac51d"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_name_and_rank" ref="a3634784808148457e7768d9ac23ac51d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_name_and_rank </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes which have the supplied rank and a name LIKE the supplied String
Argument    : Name as String (can contain SQL wildcards)
Argument    : Rank as String
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_all_by_name_and_rank" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_all_by_name_and_rank-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_by_name_and_rank-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_by_name_and_rank-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a3634784808148457e7768d9ac23ac51d">fetch_all_by_name_and_rank</a> {
  my ($self, $name, $rank) = @_;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ join ncbi_taxa_name nan <span class="keyword">using</span> (taxon_id) where nan.name like ? and n.rank = ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$name, $rank]);
  <span class="keywordflow">return</span> [values %{$node}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="af1052de92e3deaab5011405e31b94878"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_rank" ref="af1052de92e3deaab5011405e31b94878" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_rank </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes which have the supplied rank
Argument    : String
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_all_by_rank" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_all_by_rank-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_by_rank-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_by_rank-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#af1052de92e3deaab5011405e31b94878">fetch_all_by_rank</a> {
  my ($self, $rank) = @_;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ where rank = ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$rank]);
  <span class="keywordflow">return</span> [values %{$node}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a6498525eec319e5409bf467f85b10925"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_taxon_ids" ref="a6498525eec319e5409bf467f85b10925" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_by_taxon_ids </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes corresponding to the supplied taxonomy IDs
Argument    : Arrayref of Int
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_all_by_taxon_ids" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_all_by_taxon_ids-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_by_taxon_ids-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_by_taxon_ids-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a6498525eec319e5409bf467f85b10925">fetch_all_by_taxon_ids</a> {
  my ($self, $taxon_ids) = @_;
  my $list = join <span class="charliteral">&#39;,&#39;</span>, @$taxon_ids;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . qq{ where taxon_id in ($list)},
                                                -CALLBACK =&gt; $self-&gt;mapper());
  <span class="keywordflow">return</span> [values %{$node}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a4389669d002e2ca6caf932827b800aaf"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_common_ancestors" ref="a4389669d002e2ca6caf932827b800aaf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_all_common_ancestors </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-fetch_all_common_ancestors" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_all_common_ancestors-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_all_common_ancestors-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_all_common_ancestors-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a4389669d002e2ca6caf932827b800aaf">fetch_all_common_ancestors</a> {
  my ($self, $n1, $n2) = @_;
  my $anc              = $self-&gt;fetch_ancestors($n1);
  my %n1h              = map { $_-&gt;taxon_id() =&gt; $_ } @$anc;
  my $common_ancestors = [];
  <span class="keywordflow">for</span> my $n2n (@{$self-&gt;fetch_ancestors($n2)}) {
    <span class="keywordflow">if</span> (defined $n1h{$n2n-&gt;taxon_id()}) {
      push @$common_ancestors, $n2n;
    }
  }
  <span class="keywordflow">return</span> [sort { $a-&gt;num_descendants() &lt;=&gt; $b-&gt;num_descendants() } @{$common_ancestors}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a0147113a768c4679c7c3ddc9a89cd69d"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_ancestor_by_rank" ref="a0147113a768c4679c7c3ddc9a89cd69d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_ancestor_by_rank </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-fetch_ancestor_by_rank" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_ancestor_by_rank-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_ancestor_by_rank-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_ancestor_by_rank-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a0147113a768c4679c7c3ddc9a89cd69d">fetch_ancestor_by_rank</a> {
  my ($self, $n1, $rank) = @_;
  <span class="keywordflow">return</span> $n1 <span class="keywordflow">if</span> ($n1-&gt;rank() eq $rank);
  my $anc;
  <span class="keywordflow">for</span> my $a (@{$self-&gt;fetch_ancestors($n1)}) {
    <span class="keywordflow">if</span> ($a-&gt;rank() eq $rank) {
      $anc = $a;
      last;
    }
  }
  <span class="keywordflow">return</span> $anc;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="ac07a1294368c2815845978ffa18db9b5"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_ancestors" ref="ac07a1294368c2815845978ffa18db9b5" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_ancestors </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes which are above the supplied node on the tree (ordered ascending up the tree)
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_ancestors" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_ancestors-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_ancestors-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_ancestors-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ac07a1294368c2815845978ffa18db9b5">fetch_ancestors</a> {
  my ($self, $node) = @_;
  my $nodes = $self-&gt;helper()-&gt;execute_into_hash(
    -SQL =&gt; $base_sql . q{ join ncbi_taxa_node child
                                            on (child.left_index between n.left_index and n.right_index and n.taxon_id&lt;&gt;child.taxon_id)
                                            where child.taxon_id=?},
    -CALLBACK =&gt; $self-&gt;<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a143bb1730451f74d6742661bbd989775">mapper</a>(),
    -PARAMS   =&gt; [<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a74bc6bc12ca4f3f296087f2b85713855">_get_node_id</a>($node)]);
  return [sort { $a-&gt;num_descendants() &lt;=&gt; $b-&gt;num_descendants() } values %{$nodes}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a0b5c7cbb3d249793ce0c3eae5baa41b4"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_by_coredbadaptor" ref="a0b5c7cbb3d249793ce0c3eae5baa41b4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_by_coredbadaptor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch a single node corresponding to the taxonomy ID found in the supplied Ensembl DBAdaptor
Argument    : Bio::EnsEMBL::DBSQL::DBAdaptor
Return type : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_by_coredbadaptor" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_by_coredbadaptor-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_by_coredbadaptor-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_by_coredbadaptor-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a0b5c7cbb3d249793ce0c3eae5baa41b4">fetch_by_coredbadaptor</a> {
  my ($self, $core_dba) = @_;
<span class="preprocessor">  # get taxid from core</span>
<span class="preprocessor"></span>  my $taxid = $core_dba-&gt;get_MetaContainer()-&gt;get_taxonomy_id();
  <span class="keywordflow">if</span> (!defined $taxid) {
    <span class="keywordflow">throw</span>(<span class="stringliteral">&quot;Could not find taxonomy ID for database &quot;</span> . $core_dba-&gt;species());
  }
  my $node = $self-&gt;fetch_by_taxon_id($taxid);
  <span class="keywordflow">if</span> ($node) {
    push @{$node-&gt;<a class="code" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html#a5ad1007303ac34b1dc944b4c67ee91f6">dba</a>()}, $core_dba;
  }
  <span class="keywordflow">return</span> $node;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a146f983269d80d82d56f12024b8df6a1"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_by_taxon_id" ref="a146f983269d80d82d56f12024b8df6a1" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_by_taxon_id </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch a single node corresponding to the supplied taxon ID.
Argument    : Int
Return type : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_by_taxon_id" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_by_taxon_id-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_by_taxon_id-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_by_taxon_id-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a146f983269d80d82d56f12024b8df6a1">fetch_by_taxon_id</a> {
  my ($self, $taxon_id) = @_;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ where taxon_id = ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$taxon_id]);
  <span class="keywordflow">return</span> $node-&gt;{$taxon_id};
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="ab0fd45baeccfc5ff5b2b4af3f52e699e"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_children" ref="ab0fd45baeccfc5ff5b2b4af3f52e699e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_children </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes for which the parent is the supplied node
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_children" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_children-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_children-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_children-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ab0fd45baeccfc5ff5b2b4af3f52e699e">fetch_children</a> {
  my ($self, $parent) = @_;
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ where parent_id = ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a74bc6bc12ca4f3f296087f2b85713855">_get_node_id</a>($parent)]);
  <span class="keywordflow">return</span> [sort { $a-&gt;num_descendants() &lt;=&gt; $b-&gt;num_descendants() } values %{$node}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="af7d2f5acd1d17eace8d94a48a0782790"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_common_ancestor" ref="af7d2f5acd1d17eace8d94a48a0782790" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_common_ancestor </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-fetch_common_ancestor" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_common_ancestor-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_common_ancestor-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_common_ancestor-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#af7d2f5acd1d17eace8d94a48a0782790">fetch_common_ancestor</a> {
  my ($self, $n1, $n2) = @_;
  my $anc = $self-&gt;fetch_all_common_ancestors($n1, $n2);
  <span class="keywordflow">return</span> scalar(@$anc) &gt; 0 ? $anc-&gt;[0] : undef;
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="ae75c96b99f505385c7729d1090785ee3"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_descendants" ref="ae75c96b99f505385c7729d1090785ee3" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_descendants </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes below the supplied node on the tree
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_descendants" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_descendants-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_descendants-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_descendants-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#ae75c96b99f505385c7729d1090785ee3">fetch_descendants</a> {
  my ($self, $node) = @_;

  my $nodes = $self-&gt;helper()-&gt;execute_into_hash(
    -SQL =&gt; $base_sql . q{ join ncbi_taxa_node parent 
            on (n.left_index between parent.left_index and parent.right_index and n.taxon_id&lt;&gt;parent.taxon_id)
            where parent.taxon_id=?},
    -CALLBACK =&gt; $self-&gt;mapper(),
    -PARAMS   =&gt; [<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a74bc6bc12ca4f3f296087f2b85713855">_get_node_id</a>($node)]);
  return [sort { $a-&gt;num_descendants() &lt;=&gt; $b-&gt;num_descendants() } values %{$nodes}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a9b636d26c4e31842a9a023780a8990b9"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_descendants_offset" ref="a9b636d26c4e31842a9a023780a8990b9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_descendants_offset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes below the node the specified number of levels on the tree above the specified node
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Argument    : offset (number of rows to move up tree before getting descendants - default is 1)
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_descendants_offset" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_descendants_offset-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_descendants_offset-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_descendants_offset-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a9b636d26c4e31842a9a023780a8990b9">fetch_descendants_offset</a> {
  my ($self, $node, $offset) = @_;
  $offset ||= 1;
  $node = $self-&gt;_get_node($node);
  <span class="keywordflow">while</span> ($offset-- &gt; 0) {
    $node = $self-&gt;fetch_parent($node);
    <span class="keywordflow">throw</span> <span class="stringliteral">&quot;No parent found for offset query&quot;</span> unless (defined $node);
  }
  <span class="keywordflow">return</span> $self-&gt;fetch_descendants($node);
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a6f018c4e7c29a6dc11feb35f9a24c336"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_leaf_nodes" ref="a6f018c4e7c29a6dc11feb35f9a24c336" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Arrayref Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_leaf_nodes </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch an array of nodes which are the leaves below the supplied node on the tree
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Return type : Arrayref of <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_leaf_nodes" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_leaf_nodes-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_leaf_nodes-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_leaf_nodes-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a6f018c4e7c29a6dc11feb35f9a24c336">fetch_leaf_nodes</a> {
  my ($self, $node) = @_;
  my $nodes = $self-&gt;helper()-&gt;execute_into_hash(
    -SQL =&gt; $base_sql . q{ join ncbi_taxa_node parent 
            on (n.left_index between parent.left_index and parent.right_index and n.taxon_id&lt;&gt;parent.taxon_id)
            where parent.taxon_id=? and n.right_index=n.left_index+1},
    -CALLBACK =&gt; $self-&gt;mapper(),
    -PARAMS   =&gt; [<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a74bc6bc12ca4f3f296087f2b85713855">_get_node_id</a>($node)]);
  return [values %{$nodes}];
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a865809d8ad7f9bac8c618ca44ecdb7ac"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_parent" ref="a865809d8ad7f9bac8c618ca44ecdb7ac" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_parent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre> 
Description : Fetch a single node corresponding to the parent of the node
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Return type : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_parent" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_parent-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_parent-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_parent-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a865809d8ad7f9bac8c618ca44ecdb7ac">fetch_parent</a> {
  my ($self, $child) = @_;
  $child = $self-&gt;_get_node($child);
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ where taxon_id = ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$child-&gt;parent_id()]);
  <span class="keywordflow">return</span> $node-&gt;{$child-&gt;<a class="code" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html#a8412e9f7faf096e12ff53cb699b13cf9">parent_id</a>()};
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="acb7cae1f0233c91c5fb7cfdc4d66d952"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_root" ref="acb7cae1f0233c91c5fb7cfdc4d66d952" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::fetch_root </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Fetch a single node corresponding to the root of the supplied node
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a> or ID of desired node
Return type : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
 </pre><div id="codesection-fetch_root" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-fetch_root-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-fetch_root-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-fetch_root-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#acb7cae1f0233c91c5fb7cfdc4d66d952">fetch_root</a> {
  my ($self, $child) = @_;
  $child = $self-&gt;_get_node($child);
  my $node = $self-&gt;helper()-&gt;execute_into_hash(-SQL      =&gt; $base_sql . q{ where taxon_id = ?},
                                                -CALLBACK =&gt; $self-&gt;mapper(),
                                                -PARAMS   =&gt; [$child-&gt;root_id()]);
  <span class="keywordflow">return</span> $node-&gt;{$child-&gt;<a class="code" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html#a6052d12c274e1602442ec518ca46390f">root_id</a>()};
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a928c8d80cd69b686228238604f2ebf52"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::helper" ref="a928c8d80cd69b686228238604f2ebf52" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::helper </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Undocumented method</p>
<div id="codesection-helper" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-helper-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-helper-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-helper-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a928c8d80cd69b686228238604f2ebf52">helper</a> {
  my ($self) = @_;
  <span class="keywordflow">if</span> (!defined $self-&gt;{<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a928c8d80cd69b686228238604f2ebf52">helper</a>}) {
    $self-&gt;{<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a928c8d80cd69b686228238604f2ebf52">helper</a>} = Bio::EnsEMBL::Utils::SqlHelper-&gt;new(-DB_CONNECTION =&gt; $self-&gt;dbc());
  }
  <span class="keywordflow">return</span> $self-&gt;{<a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a928c8d80cd69b686228238604f2ebf52">helper</a>};
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a143bb1730451f74d6742661bbd989775"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::mapper" ref="a143bb1730451f74d6742661bbd989775" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::mapper </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre> </pre><div id="codesection-mapper" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-mapper-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-mapper-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-mapper-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub mapper {
  my ($self) = @_;
  <span class="keywordflow">if</span> (!defined $self-&gt;{mapper}) {
    $self-&gt;{mapper} = sub {
      my @row   = @{shift @_};
      my $value = shift;
      <span class="keywordflow">if</span> (!$value) {
        $value = <a class="code" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>-&gt;<a class="code" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html#a2b2d63b1cb0a7e146f8a60d449c48af9">new</a>(-TAXON_ID    =&gt; $row[0],
                                                 -PARENT_ID   =&gt; $row[1],
                                                 -RANK        =&gt; $row[2],
                                                 -ROOT_ID     =&gt; $row[3],
                                                 -LEFT_INDEX  =&gt; $row[4],
                                                 -RIGHT_INDEX =&gt; $row[5],
                                                 -ADAPTOR     =&gt; $self);
      }
      push @{$value-&gt;names()-&gt;{$row[6]}}, $row[7];
      <span class="keywordflow">return</span> $value;
    };
  }
  <span class="keywordflow">return</span> $self-&gt;{mapper};
}
</pre></div> </div> 
</div>
</div>
<a class="anchor" id="a02d590171e2d14da87085d57116d751f"></a><!-- doxytag: member="Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::set_num_descendants" ref="a02d590171e2d14da87085d57116d751f" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">public void Bio::EnsEMBL::DBSQL::TaxonomyNodeAdaptor::set_num_descendants </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<pre>
Description : Traverse the supplied tree setting number of descendants based on current tree structure
Argument    : <a class="el" href="classBio_1_1EnsEMBL_1_1TaxonomyNode.html">Bio::EnsEMBL::TaxonomyNode</a>
Return type : None
 </pre><div id="codesection-set_num_descendants" class="dynheader closed" style="cursor:pointer;" onclick="return toggleVisibility(this)">  
	<img id='codesection-set_num_descendants-trigger' src='closed.png' style='display:inline'><b>Code:</b>
</div>
<div id='codesection-set_num_descendants-summary' class='dyncontent' style='display:block;font-size:small;'>click to view</div>
<div id='codesection-set_num_descendants-content' class='dyncontent' style='display: none;'> 
 <div class="fragment"><pre class="fragment">sub <a class="code" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html#a02d590171e2d14da87085d57116d751f">set_num_descendants</a> {
  my ($self, $node) = @_;
  $node-&gt;{num_descendants} = 0;
  <span class="keywordflow">for</span> my $child (@{$node-&gt;children()}) {
    $node-&gt;{num_descendants} += 1 + $self-&gt;set_num_descendants($child);
  }
  <span class="keywordflow">return</span> $node-&gt;num_descendants();
}
</pre></div> </div> 
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/homes/nickl/dev/bacteria_new_9310/ensemblgenomes-api/modules/Bio/EnsEMBL/DBSQL/<a class="el" href="TaxonomyNodeAdaptor_8pm_source.html">TaxonomyNodeAdaptor.pm</a></li>
</ul>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespaceBio.html">Bio</a>      </li>
      <li class="navelem"><a class="el" href="namespaceBio_1_1EnsEMBL.html">EnsEMBL</a>      </li>
      <li class="navelem"><a class="el" href="namespaceBio_1_1EnsEMBL_1_1DBSQL.html">DBSQL</a>      </li>
      <li class="navelem"><a class="el" href="classBio_1_1EnsEMBL_1_1DBSQL_1_1TaxonomyNodeAdaptor.html">TaxonomyNodeAdaptor</a>      </li>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  </div>
</body>
</html>
